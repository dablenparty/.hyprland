##################
### WORKSPACES ###
##################

# See https://wiki.hyprland.org/Configuring/Workspace-Rules/ for workspace rules

$gamingWorkspace = 10
workspace = $gamingWorkspace, defaultName:Gaming, border:false, shadow:false, rounding:false, decorate:false

# smart gaps (https://wiki.hypr.land/Configuring/Workspace-Rules/#smart-gaps)
workspace = w[tv1], gapsout:0, gapsin:0
workspace = f[1], gapsout:0, gapsin:0
windowrule {
    name = smart-gaps-tiled
    match:float = false
    match:workspace = w[tv1]

    border_size = 0
    rounding = 0
}
windowrule {
    name = smart-gaps-maximized
    match:float = false
    match:workspace = f[1]

    border_size = 0
    rounding = 0
}

###############
### WINDOWS ###
###############

# See https://wiki.hyprland.org/Configuring/Window-Rules/ for more

# Ignore maximize requests from apps. You'll probably like this.
windowrule = match:class .*, suppress_event maximize

# Fix some dragging issues with XWayland
windowrule {
    name = xwayland-dragging-fix
    match:class = ^$
    match:title = ^$
    match:xwayland = true
    match:float = true
    match:fullscreen = false
    match:pin = false

    no_focus = true
}

# Fix steam client launching floating
windowrule = match:initial_class ^steam$, tile true

$steamAppClass = ^steam_app(_\d+|default)?$
$terminalClass = ^(\w+\.)*foot$

windowrule = match:initial_class makemkv, idle_inhibit always
windowrule {
    name = makemkv-popup
    match:class = makemkv
    match:title = .*popup$

    no_initial_focus = true
    focus_on_activate = false
    suppress_event = activate,activatefocus
}

# Content Types
windowrule = match:initial_class vlc, content video
windowrule = match:initial_class mpv, content video
windowrule = match:initial_class .*jellyfin-media-player$, content video
windowrule = match:title ^(Picture-In-Picture)$, content video
windowrule = match:title ^.*(- YouTube).*$, match:class $browserClass, content video

# Game Window Rules
# default monitors are handled by proton.zsh
windowrule = match:xdg_tag ^(proton-game)$,              tag +video-game
# matches content game
windowrule = match:content 3,                            tag +video-game
windowrule = match:initial_class $steamAppClass,         tag +video-game
windowrule = match:initial_class ^(.*\.exe)$,            tag +video-game
# just add the names of modpacks
windowrule = match:initial_title ^(Minecraft|Tekxit).*$, tag +video-game
windowrule = match:initial_class ^(artofrally).*$,       tag +video-game

windowrule = match:class $steamAppClass, match:title SplashScreen,    tag -video-game
windowrule = match:tag video-game, match:title ([Cc]rash.?[Rr]eport), tag -video-game

windowrule {
    name = video-games
    match:tag = video-game
    workspace = $gamingWorkspace

    immediate = true

    border_size = 0
    # even if they're tagged, they STILL might not have the right content type
    content = game
    decorate = false
    # truly opaque; ignores window alpha channel
    force_rgbx = true
    fullscreen = true
    # using 2 2 doesn't work for some games *cough* ELDEN RING
    fullscreen_state = 3 3
    idle_inhibit = always
    no_anim = true
    no_blur = true
    no_dim = true
    no_max_size = true
    no_shadow = true
    opacity = 1.00 override 1.00 override 1.00 override
    opaque = true
    persistent_size = true
    pseudo = true
    render_unfocused = true
    rounding = 0
    # fixes games that fail to maximize *cough* ELDEN RING
    sync_fullscreen = true
}

# Blurry Windows
# extracted for easy switching
$browserClass = ^([Ff]irefox)$
windowrule = match:class ^([Ss]team(webhelper)?)$,  opacity 0.90 override 0.81 override
windowrule = match:class ^(net\.)?([Ll]utris\.?)+$, opacity 0.90 override 0.81 override
windowrule = match:class $browserClass,             opacity 0.90 override 0.81 override

# WARN: these must come after all other opacity rules
windowrule = match:content 2, opacity 1.00 override 1.00 override
# matches content video
windowrule = match:content 2, idle_inhibit fullscreen

##############
### LAYERS ###
##############

layerrule {
    name = app-launcher-blur
    match:namespace = launcher

    blur = true
    ignore_alpha = 0
    dim_around = true
}

layerrule {
    name = notifications-blur
    match:namespace = notifications

    blur = true
    ignore_alpha = 0
    # block from screen share
    no_screen_share = true
}
